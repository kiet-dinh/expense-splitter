---
phase: 02-core-ui
plan: 03
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - gsd-module-test/src/components/AssignSection.tsx
  - gsd-module-test/src/components/AssignSection.test.tsx
  - gsd-module-test/src/components/TipTaxSection.tsx
  - gsd-module-test/src/components/TipTaxSection.test.tsx
  - gsd-module-test/src/components/ResultsSection.tsx
  - gsd-module-test/src/components/ResultsSection.test.tsx
  - gsd-module-test/src/App.tsx
autonomous: true
requirements:
  - ASSIGN-01
  - ASSIGN-02
  - ASSIGN-03
  - ASSIGN-04
  - TIP-01
  - TIP-02
  - TAX-01
  - TAX-02
  - RESULT-01
  - RESULT-02

must_haves:
  truths:
    - "User can assign an item to a single person"
    - "User can assign an item to multiple people for equal split"
    - "User can assign an item with custom dollar-amount portions per person"
    - "User can assign an item to everyone with one click"
    - "User can select tip from preset buttons (15%, 18%, 20%) or enter custom percentage"
    - "User can toggle tip split between equal and proportional"
    - "User can enter tax as dollar amount or percentage"
    - "User can toggle tax split between equal and proportional"
    - "User sees per-person breakdown with subtotal, tip share, tax share, and total"
    - "User sees grand-total verification showing zero difference"
  artifacts:
    - path: "gsd-module-test/src/components/AssignSection.tsx"
      provides: "Item assignment UI with 4 assignment modes"
      min_lines: 80
    - path: "gsd-module-test/src/components/AssignSection.test.tsx"
      provides: "Assignment component tests"
      min_lines: 40
    - path: "gsd-module-test/src/components/TipTaxSection.tsx"
      provides: "Tip preset buttons, custom tip input, tax amount/percent toggle, split mode toggles"
      min_lines: 60
    - path: "gsd-module-test/src/components/TipTaxSection.test.tsx"
      provides: "Tip/tax component tests"
      min_lines: 30
    - path: "gsd-module-test/src/components/ResultsSection.tsx"
      provides: "Per-person breakdown table and grand-total verification"
      min_lines: 40
    - path: "gsd-module-test/src/components/ResultsSection.test.tsx"
      provides: "Results component tests"
      min_lines: 30
  key_links:
    - from: "gsd-module-test/src/components/AssignSection.tsx"
      to: "gsd-module-test/src/store/billStore.ts"
      via: "useBillStore for items, people, assignments, setAssignment"
      pattern: "useBillStore|setAssignment"
    - from: "gsd-module-test/src/components/TipTaxSection.tsx"
      to: "gsd-module-test/src/store/billStore.ts"
      via: "useBillStore for tip/tax state and setters"
      pattern: "useBillStore|setTipPercent|setTaxMode"
    - from: "gsd-module-test/src/components/ResultsSection.tsx"
      to: "gsd-module-test/src/store/computeResults.ts"
      via: "calls computeResults with store state"
      pattern: "computeResults"
    - from: "gsd-module-test/src/components/ResultsSection.tsx"
      to: "gsd-module-test/src/engine/math.ts"
      via: "centsToDollars for display formatting"
      pattern: "centsToDollars"
    - from: "gsd-module-test/src/App.tsx"
      to: "gsd-module-test/src/components/AssignSection.tsx"
      via: "imports and renders AssignSection"
      pattern: "import.*AssignSection"
    - from: "gsd-module-test/src/App.tsx"
      to: "gsd-module-test/src/components/ResultsSection.tsx"
      via: "imports and renders ResultsSection"
      pattern: "import.*ResultsSection"
---

<objective>
Build the Assignment, Tip/Tax, and Results UI sections — completing the full bill-splitting workflow. Users can assign items to people, configure tip and tax, and see a verified per-person breakdown.

Purpose: This plan completes the Phase 2 happy path. After this plan, the app delivers its core value: enter a bill, assign items, add tip/tax, see what everyone owes.

Output: AssignSection.tsx, TipTaxSection.tsx, ResultsSection.tsx, their test files, and App.tsx updated to render all five sections.
</objective>

<execution_context>
@C:/Users/Kiet Dinh/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Kiet Dinh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-ui/02-01-SUMMARY.md
@.planning/phases/02-core-ui/02-02-SUMMARY.md
@.planning/phases/02-core-ui/02-RESEARCH.md (Pattern 2: computeResults, Pattern 4: Price Input, Pattern 6: useShallow)
@gsd-module-test/src/store/billStore.ts
@gsd-module-test/src/store/computeResults.ts
@gsd-module-test/src/engine/math.ts
@gsd-module-test/src/components/PeopleSection.tsx
@gsd-module-test/src/components/ItemSection.tsx
@gsd-module-test/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AssignSection component with all 4 assignment modes</name>
  <files>
    gsd-module-test/src/components/AssignSection.tsx
    gsd-module-test/src/components/AssignSection.test.tsx
  </files>
  <action>
    **Create `src/components/AssignSection.tsx`:**

    Structure — for each item in the store, display a card/row showing:
    - Item name and price (read-only display)
    - Current assignment status (unassigned, or who it's assigned to)
    - Assignment mode selector (radio buttons or segmented control): "One Person", "Split Equal", "Custom", "Everyone"
    - Mode-specific UI:
      - **One Person (single):** Dropdown/select with all people names. On select → `setAssignment(itemId, { mode: 'single', personId })`
      - **Split Equal (equal):** Checkboxes for each person. On change → `setAssignment(itemId, { mode: 'equal', personIds: checkedIds })`. Must have at least 1 checked.
      - **Custom:** For each person, show a dollar-amount input (their "portion weight"). Uses string state while typing, converts to cents on blur via `dollarsToCents`. On blur → `setAssignment(itemId, { mode: 'custom', portions: [{ personId, weight: cents }, ...] })`. Only include people with weight > 0.
      - **Everyone:** A single "Assign to Everyone" button. On click → `setAssignment(itemId, { mode: 'everyone' })`

    Implementation details:
    - If no items or no people exist, show a helpful message: "Add people and items first"
    - Use `useShallow` for store selection: `{ items, people, assignments, setAssignment }`
    - For custom portions, use `dollarsToCents` from engine/math for weight conversion
    - Each item's assignment mode is local state initialized from the current assignment in the store
    - When switching modes, immediately update the store assignment (or set to unassigned if incomplete)
    - Use `useId()` for accessible form labels within repeated rows
    - Tailwind: cards with border, mode selector as pill buttons, nested form controls

    **Create `src/components/AssignSection.test.tsx`:**

    Top of file: `// @vitest-environment jsdom`

    Setup: seed store with 2 people (Alice, Bob) and 1 item (Pizza, 1000 cents) in `beforeEach`.

    Tests:
    - Shows "Add people and items first" when store is empty
    - Displays item name and price
    - Single mode: select a person → assignment updates in store
    - Equal mode: check two people → assignment stored with both personIds
    - Everyone mode: click button → assignment stored as mode "everyone"
    - Custom mode: enter dollar weights → assignment stored with portions
    - Switching modes updates the store assignment
  </action>
  <verify>
    - `cd gsd-module-test && npx vitest run src/components/AssignSection.test.tsx` — all tests pass
    - `npx tsc --noEmit` — no type errors
  </verify>
  <done>AssignSection supports all 4 assignment modes (single, equal, custom, everyone) with proper store integration. All component tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Create TipTaxSection, ResultsSection, and wire final App.tsx</name>
  <files>
    gsd-module-test/src/components/TipTaxSection.tsx
    gsd-module-test/src/components/TipTaxSection.test.tsx
    gsd-module-test/src/components/ResultsSection.tsx
    gsd-module-test/src/components/ResultsSection.test.tsx
    gsd-module-test/src/App.tsx
  </files>
  <action>
    **Create `src/components/TipTaxSection.tsx`:**

    Structure — two subsections: Tip and Tax.

    **Tip subsection:**
    - Preset buttons: 15%, 18%, 20% — clicking one sets `tipPercent` to that value. Active button is visually highlighted.
    - Custom input: a percentage number input. Typing a value overrides preset selection. Keep string state while typing, parse to number on blur, call `setTipPercent`.
    - Split mode toggle: two buttons "Equal" and "Proportional". Calls `setTipSplitMode`.

    **Tax subsection:**
    - Mode toggle: "Dollar Amount" or "Percentage" radio/buttons. Calls `setTaxMode`.
    - Value input: dollar input (if mode='amount') or percentage input (if mode='percent'). String state while typing, convert on blur. For amount: `dollarsToCents(input)` → `setTaxValue(cents)`. For percent: `parseFloat(input)` → `setTaxValue(percent)`.
    - Split mode toggle: "Equal" and "Proportional" buttons. Calls `setTaxSplitMode`.

    Implementation details:
    - Use `useShallow` for: `{ tipPercent, tipSplitMode, taxMode, taxValue, taxSplitMode, setTipPercent, setTipSplitMode, setTaxMode, setTaxValue, setTaxSplitMode }`
    - Import `dollarsToCents`, `centsToDollars` from engine/math for tax amount display
    - When switching tax mode, reset taxValue to 0 (avoid stale value from different mode)
    - Tailwind: card layout, button groups with active states, input fields with labels

    **Create `src/components/TipTaxSection.test.tsx`:**

    Top of file: `// @vitest-environment jsdom`

    Tests:
    - Renders tip preset buttons (15%, 18%, 20%)
    - Clicking 20% preset sets tipPercent to 20 in store
    - Custom tip input overrides preset
    - Tip split mode toggle works (equal ↔ proportional)
    - Tax mode toggle switches between amount and percent
    - Entering tax dollar amount stores correct cents in store
    - Entering tax percentage stores correct number in store
    - Tax split mode toggle works

    **Create `src/components/ResultsSection.tsx`:**

    Structure:
    - Reads all relevant state from store using `useShallow`
    - Calls `computeResults(people, items, assignments, tipPercent, tipSplitMode, taxMode, taxValue, taxSplitMode)`
    - Displays per-person breakdown: a card/row per person showing:
      - Person name
      - Subtotal: `centsToDollars(person.subtotalCents)`
      - Tip share: `centsToDollars(person.tipCents)`
      - Tax share: `centsToDollars(person.taxCents)`
      - **Total: `centsToDollars(person.totalCents)`** (bold/emphasized)
    - Grand total summary:
      - Subtotal: `centsToDollars(results.subtotalCents)`
      - Tip: `centsToDollars(results.tipCents)`
      - Tax: `centsToDollars(results.taxCents)`
      - Grand Total: `centsToDollars(results.grandTotalCents)`
    - Verification line: "Verification: difference = $X.XX" — should always show $0.00. If non-zero, show in red as a warning.
    - If no people, show "Add people to see results"
    - Warn about unassigned items: count items with no assignment or mode='unassigned', show "N items unassigned — $X.XX not included in totals" if any exist

    Implementation details:
    - Import `computeResults` from `'../store/computeResults'`
    - Import `centsToDollars` from `'../engine/math'`
    - Use `useMemo` to avoid recomputing on every render: `useMemo(() => computeResults(...), [people, items, assignments, ...])`
    - Tailwind: card per person, table-like layout for amounts, verification in green (match) or red (mismatch)

    **Create `src/components/ResultsSection.test.tsx`:**

    Top of file: `// @vitest-environment jsdom`

    Setup: seed store with 2 people, 2 items, assignments, tip, and tax.

    Tests:
    - Shows "Add people to see results" when no people
    - Displays per-person breakdown with correct values
    - Shows grand total matching sum of per-person totals
    - Verification shows $0.00 difference
    - Shows unassigned items warning when items lack assignments
    - Updates when store state changes (add tip → tip shares appear)

    **Update `src/App.tsx`:**

    Add imports for all 3 new sections and render them in order:
    ```tsx
    import { PeopleSection } from './components/PeopleSection'
    import { ItemSection } from './components/ItemSection'
    import { AssignSection } from './components/AssignSection'
    import { TipTaxSection } from './components/TipTaxSection'
    import { ResultsSection } from './components/ResultsSection'

    function App() {
      return (
        <div className="min-h-screen bg-gray-50">
          <div className="mx-auto max-w-2xl px-4 py-8">
            <h1 className="text-2xl font-bold text-gray-900 mb-6">Expense Splitter</h1>
            <div className="space-y-6">
              <PeopleSection />
              <ItemSection />
              <AssignSection />
              <TipTaxSection />
              <ResultsSection />
            </div>
          </div>
        </div>
      )
    }

    export default App
    ```
    Remove the comment placeholder from 02-02.
  </action>
  <verify>
    - `cd gsd-module-test && npx vitest run` — ALL tests pass (engine + store + computeResults + all 5 component test files)
    - `cd gsd-module-test && npx tsc --noEmit` — no type errors
    - `cd gsd-module-test && npm run build` — builds without errors
    - `cd gsd-module-test && npm run dev` — full app renders all 5 sections
  </verify>
  <done>TipTaxSection supports preset/custom tip, amount/percent tax, and equal/proportional split modes. ResultsSection displays per-person breakdown with verification. App.tsx renders all 5 sections. Full Phase 2 happy path is complete.</done>
</task>

</tasks>

<verification>
1. `cd gsd-module-test && npx vitest run` — all tests pass
2. `cd gsd-module-test && npx tsc --noEmit` — no type errors
3. `cd gsd-module-test && npm run build` — builds
4. `cd gsd-module-test && npm run dev` — full app works end-to-end
5. Manual walkthrough: add 2 people → add 3 items → assign items (one single, one equal, one everyone) → set 20% tip proportional → enter $5 tax → verify per-person breakdown shows correct values → verification shows $0.00 difference
</verification>

<success_criteria>
- AssignSection: all 4 assignment modes work (single, equal, custom, everyone)
- TipTaxSection: preset buttons, custom tip, dollar/percent tax, equal/proportional split toggles
- ResultsSection: per-person breakdown, grand total, verification check, unassigned items warning
- App.tsx renders all 5 sections in a mobile-first vertical layout
- Full happy path: people → items → assignments → tip/tax → verified results
- All tests pass across all environments
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-ui/02-03-SUMMARY.md`
</output>
