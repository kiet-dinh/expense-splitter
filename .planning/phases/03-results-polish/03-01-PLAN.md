# Phase 3.1: Copy-to-Clipboard Summary and Itemized Receipt

## Goal
Users can share the split result via copy-to-clipboard and inspect exactly which items they owe through an itemized receipt view.

## Success Criteria
1. User can copy a formatted text summary of the split to the clipboard with one tap
2. User can view an itemized receipt showing each person's individual items and their assigned shares

## Requirements Mapping
- RESULT-03: Copy-to-clipboard summary for sharing
- RESULT-04: Itemized receipt view per person

## Implementation Overview

### 1. Copy-to-Clipboard Button (ResultsSection)
Add a prominent "Copy Summary" button to the ResultsSection that generates a formatted text summary.

**Text Format:**
```
Bill Split Summary
==================

Alice: $32.50
  Subtotal: $25.00
  Tip: $4.50
  Tax: $3.00

Bob: $28.75
  Subtotal: $22.00
  Tip: $3.75
  Tax: $3.00

------------------
Grand Total: $61.25
```

**Implementation:**
- Add `CopyButton` component or inline button in ResultsSection
- Use `navigator.clipboard.writeText()` API
- Show visual feedback ("Copied!" toast or button state change)
- Handle permission denial gracefully (fallback message)

**Code Pattern:**
```tsx
const handleCopy = async () => {
  const summary = generateTextSummary(results, people, items, assignments)
  try {
    await navigator.clipboard.writeText(summary)
    setCopied(true)
    setTimeout(() => setCopied(false), 2000)
  } catch {
    // Fallback: show summary in modal for manual copy
  }
}
```

### 2. Itemized Receipt View
Add an expandable/collapsible itemized breakdown per person showing exactly which items they owe and how much.

**UI Structure:**
- Add "Show details" / "Hide details" toggle per person in ResultsSection
- When expanded, show a table/list of:
  - Item name
  - Full item price
  - Their share amount
  - Split indicator (e.g., "split with Bob" for equal splits)

**Data Requirements:**
Need a new function to compute itemized breakdown per person:
```ts
interface PersonItemizedBreakdown {
  personId: string
  name: string
  items: {
    itemId: string
    itemName: string
    fullPriceCents: number
    theirShareCents: number
    splitNote: string | null  // e.g., "split 2 ways", "60% share"
  }[]
}
```

**Implementation:**
- Create `computeItemizedBreakdown()` utility function
- Store can expose this or it can be a pure function like computeResults
- Render as nested list inside each person's result card
- Use smaller text, muted colors for itemized rows

### 3. Testing

**Copy-to-Clipboard Tests:**
- Mock `navigator.clipboard` in tests
- Verify correct text format generated
- Verify "Copied" feedback appears
- Verify graceful handling of clipboard denial

**Itemized Receipt Tests:**
- Test computeItemizedBreakdown with various assignment modes:
  - Single person item
  - Equal split between 2+ people
  - Custom portion split
  - Everyone split
- Test UI expansion/collapse toggle
- Verify correct share amounts displayed

### 4. Files to Modify/Create

**Modify:**
- `src/components/ResultsSection.tsx` — Add copy button and itemized view
- `src/components/ResultsSection.test.tsx` — Add tests for new features

**Create:**
- `src/engine/formatSummary.ts` — Generate formatted text summary
- `src/engine/itemizedBreakdown.ts` — Compute itemized breakdown per person
- `src/engine/itemizedBreakdown.test.ts` — Tests for itemized computation

## Verification Steps
1. Add 2+ people, 3+ items with different assignment modes
2. Click "Copy Summary" — verify formatted text copied to clipboard
3. Paste into text editor — verify format is readable
4. Click "Show details" for each person — verify itemized list appears
5. Verify split items show correct share amounts and split notes
6. Run all tests — verify they pass

## Risks & Mitigations
| Risk | Mitigation |
|------|------------|
| Clipboard API not supported | Feature-detect and show fallback modal with selectable text |
| Large bills create unwieldy text | Truncate item names or use compact format |
| UI clutter from itemized view | Default collapsed, clean expandable design |
